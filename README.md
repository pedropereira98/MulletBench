# MulletBench: Multi-layer Edge Time Series Database Benchmark

MulletBench is a TSDB benchmarking tool with a focus on edge-cloud hybrid deployments, providing per-node and per-layer metrics, automatic database cluster deployment and distributed workload generation.

## How to use MulletBench

1. Install initial dependencies:

    ``` bash
    curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py
    python3 get-pip.py --user
    python3 -m pip install --user ansible
    ```

    If you get a warning about PATH, you may need to add the mentioned directory to the PATH variable

2. Clone the repository:

    ``` bash
    git clone https://github.com/pedropereira98/MulletBench
    ```

    The machine where the test is run needs passwordless SSH access to all the machines in the present in the test cluster.

3. Install Ansible dependencies:

    ``` bash
    cd ansible
    ansible-galaxy install -r requirements.yml
    ```

4. Prepare dataset:

    Since the benchmark expects csv files without header, you may need to remove the first line from the dataset. You can achieve that by defining a `FILE` environment variable with the dataset path and running `tail -n +2 "$FILE" > "$FILE.tmp" && mv "$FILE.tmp" "$FILE"`

5. Configure test:

    Several example test configurations which can be used as a starting point can be found in the `examples` directory. The values for `ansible_host` and `ansible_user` must be updated for the clients and database servers to match the addresses and users of the machines in which the test should be run.

## Running a test

To run any test, the used dataset must be downloaded andd place it in the directory `ansible/roles/benchmark-client/files/data`.
The current implementation supports the usage of the Passive Vehicular Sensors dataset.

To run a single test run without any automatic graph generation, run:

``` bash
cd ansible
ansible-playbook playbook.yaml -i <path to test configuration> 
```

To perform multiple runs with automatic graph generation and cleanup between runs, run:

``` bash
cd test-scripts
./run-test.sh -t <path to test configuration>
```

Several example test configurations can be found in the `examples` directory.

## Benchmark results

To view the output of the test run:

``` bash
docker logs mulletbench-orchestrator
```

Additional tags can be used, such as `--tail x` to limit the output to the last `x` lines or `--follow` to update the output as the test runs.

Result graphs for tests can be generated by copying the test results from `/tmp/mulletbench-orch/run-TESTID` to `results-plot/data` and running the python script `plot.py`. When running tests using the `run-test.sh` script, result graphs are automatically generated.

## Configuration options

You can check out all the available configuration options in [options.md](OPTIONS.md).